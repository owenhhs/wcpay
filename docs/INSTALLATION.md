# WooCommerce Pay 插件安装配置指南

## 系统要求

### 必需环境
- **WordPress**: 5.0 或更高版本
- **WooCommerce**: 3.0 或更高版本
- **PHP**: 7.2 或更高版本
- **MySQL**: 5.6 或更高版本

### 推荐环境
- **WordPress**: 最新稳定版
- **WooCommerce**: 最新稳定版
- **PHP**: 7.4 或更高版本
- **SSL证书**: 生产环境必需

### 可选插件
- **Extra Checkout Fields for Brazil**: 用于透明结账功能（推荐）

## 安装步骤

### 方法一：通过WordPress后台安装

1. **登录WordPress后台**
   - 访问 `your-site.com/wp-admin`
   - 使用管理员账户登录

2. **上传插件**
   - 进入 **插件** → **安装插件**
   - 点击 **上传插件**
   - 选择插件ZIP文件
   - 点击 **立即安装**

3. **激活插件**
   - 安装完成后点击 **激活插件**

### 方法二：通过FTP安装

1. **下载插件文件**
   - 解压插件ZIP文件

2. **上传到服务器**
   - 使用FTP客户端连接到服务器
   - 导航到 `/wp-content/plugins/` 目录
   - 上传整个插件文件夹

3. **激活插件**
   - 登录WordPress后台
   - 进入 **插件** → **已安装的插件**
   - 找到 "pay" 插件
   - 点击 **启用**

### 方法三：通过WP-CLI安装

```bash
# 进入WordPress目录
cd /path/to/wordpress

# 安装插件
wp plugin install woocommerce-pay.zip --activate
```

## 配置步骤

### 第一步：访问设置页面

1. 登录WordPress后台
2. 进入 **WooCommerce** → **设置**
3. 点击 **支付** 标签
4. 找到 **pay** 支付方式
5. 点击 **管理** 或 **设置**

### 第二步：基本配置

#### 1. 启用支付网关

- 勾选 **启用/禁用** 复选框
- 选择 **启用 pay**

#### 2. 设置显示信息

- **标题**: 支付方式在结账页面显示的名称
  - 默认: "Payment"
  - 建议: "LarkPay支付" 或自定义名称

- **订单按钮文本**: 结账按钮显示的文字
  - 默认: "Payment"
  - 建议: "前往支付" 或 "Proceed to payment"

- **描述**: 支付方式的说明文字
  - 默认: "Aggregate payment"
  - 建议: 添加支付说明和注意事项

### 第三步：API凭证配置

#### 生产环境配置

1. **APP ID**
   - 从LarkPay商户后台获取
   - 格式: 数字字符串
   - 示例: `2017051914172236111`

2. **Secret Key**
   - 从LarkPay商户后台获取
   - 格式: 字符串
   - **重要**: 请妥善保管，不要泄露

3. **Public Key**
   - 从LarkPay商户后台获取
   - 格式: 字符串
   - 用于前端支付

#### 沙盒环境配置（测试用）

1. **启用沙盒模式**
   - 勾选 **pay Sandbox** 复选框
   - 用于测试支付流程

2. **沙盒凭证**
   - **Sandbox APP ID**: 测试环境应用ID
   - **Sandbox Secret Key**: 测试环境密钥
   - **Sandbox Public Key**: 测试环境公钥

### 第四步：高级配置

#### 调试设置

- **Debug Log**: 启用调试日志
  - 开发阶段建议启用
  - 生产环境建议关闭
  - 日志位置: `WooCommerce → 状态 → 日志`

#### 其他设置

- **Invoice Prefix**: 订单号前缀
  - 默认: "WC-"
  - 用于区分不同来源的订单

## 获取API凭证

### 步骤1：注册LarkPay账户

1. 访问 [LarkPay官网](https://www.larkpay.com/)
2. 点击 **注册** 或 **Sign Up**
3. 填写商户信息
4. 完成账户验证

### 步骤2：登录商户后台

1. 访问LarkPay商户后台
2. 使用注册的账户登录

### 步骤3：获取API凭证

1. 进入 **设置** → **API设置** 或 **开发者设置**
2. 找到以下信息：
   - **APP ID** (应用ID)
   - **Secret Key** (密钥)
   - **Public Key** (公钥)

3. 复制这些凭证
4. 粘贴到WordPress插件设置中

### 步骤4：获取测试凭证

1. 在商户后台找到 **沙盒/测试环境** 设置
2. 获取测试环境的API凭证
3. 在插件中启用沙盒模式
4. 使用测试凭证进行测试

## 配置验证

### 检查清单

完成配置后，请检查以下项目：

- [ ] 支付网关已启用
- [ ] API凭证已正确填写
- [ ] 沙盒模式已正确配置（如使用）
- [ ] 调试日志已配置（如需要）
- [ ] SSL证书已安装（生产环境）

### 测试支付

1. **创建测试订单**
   - 添加商品到购物车
   - 进入结账页面
   - 选择pay支付方式

2. **完成支付流程**
   - 填写订单信息
   - 点击支付按钮
   - 应该重定向到LarkPay支付页面

3. **验证IPN回调**
   - 完成支付后
   - 检查订单状态是否更新
   - 查看调试日志（如启用）

## 常见配置问题

### 问题1：支付网关不显示

**可能原因**:
- 支付网关未启用
- API凭证未填写
- 货币不支持

**解决方法**:
1. 检查支付网关设置中的"启用/禁用"选项
2. 确保APP ID、Secret Key和Public Key都已填写
3. 检查WooCommerce货币设置

### 问题2：API凭证错误

**可能原因**:
- 凭证输入错误
- 使用了错误的凭证（生产/测试混淆）
- 凭证已过期

**解决方法**:
1. 仔细检查凭证是否正确复制
2. 确认使用的是正确的环境凭证
3. 联系LarkPay技术支持更新凭证

### 问题3：IPN回调失败

**可能原因**:
- notify_url不可访问
- 服务器防火墙阻止
- SSL证书问题

**解决方法**:
1. 检查服务器是否可以从外部访问
2. 检查防火墙设置
3. 确保使用HTTPS（生产环境）

### 问题4：订单状态未更新

**可能原因**:
- IPN回调未接收
- 签名验证失败
- 订单ID不匹配

**解决方法**:
1. 检查调试日志
2. 验证Secret Key是否正确
3. 检查订单ID格式

## 生产环境检查清单

在将插件部署到生产环境前，请确保：

### 安全设置

- [ ] 使用HTTPS（SSL证书）
- [ ] 使用生产环境API凭证
- [ ] 关闭沙盒模式
- [ ] 关闭调试日志（或限制访问）
- [ ] 定期更新插件

### 功能测试

- [ ] 测试支付流程
- [ ] 验证IPN回调
- [ ] 测试订单状态更新
- [ ] 测试退款流程
- [ ] 测试错误处理

### 性能优化

- [ ] 启用缓存（如适用）
- [ ] 优化数据库查询
- [ ] 监控API响应时间
- [ ] 设置合理的超时时间

## 维护建议

### 定期检查

1. **每周检查**
   - 查看错误日志
   - 检查支付成功率
   - 验证订单状态同步

2. **每月检查**
   - 更新插件版本
   - 检查API凭证有效期
   - 审查安全设置

3. **每季度检查**
   - 全面测试支付流程
   - 检查服务器性能
   - 更新文档和配置

### 备份

- 定期备份WordPress数据库
- 备份插件配置文件
- 保存API凭证（安全存储）

## 技术支持

### 获取帮助

1. **查看文档**
   - 阅读README.md
   - 查看DOCUMENTATION.md
   - 检查常见问题

2. **检查日志**
   - 启用调试日志
   - 查看WooCommerce日志
   - 检查服务器错误日志

3. **联系支持**
   - LarkPay技术支持
   - WordPress社区支持
   - 插件开发者

### 有用的链接

- [LarkPay官网](https://www.larkpay.com/)
- [WooCommerce文档](https://woocommerce.com/documentation/)
- [WordPress文档](https://wordpress.org/support/)

## 卸载说明

### 卸载前准备

1. **备份数据**
   - 备份订单数据
   - 备份支付记录
   - 保存API凭证

2. **处理未完成订单**
   - 检查待处理订单
   - 处理退款（如需要）
   - 通知客户

### 卸载步骤

1. **停用插件**
   - 进入 **插件** → **已安装的插件**
   - 找到pay插件
   - 点击 **停用**

2. **删除插件**
   - 点击 **删除**
   - 确认删除

3. **清理数据**（可选）
   - 删除支付网关设置
   - 清理相关数据库表（如需要）

### 卸载后

- 检查订单是否正常
- 验证其他支付方式
- 更新网站文档

---

**配置完成后，您的WooCommerce商店就可以接受LarkPay支付了！**

如有任何问题，请参考文档或联系技术支持。

